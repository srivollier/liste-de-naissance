<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title id="page-title">Liste de naissance</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üë∂</text></svg>" />
  <style>
    :root { 
      color-scheme: light dark;
      --baby-pink: #ff9ec7;
      --baby-blue: #89cff0;
      --baby-yellow: #ffd166;
      --baby-mint: #98d8c8;
      --baby-lavender: #c7b3e5;
      --baby-peach: #ffb5a7;
    }
    body { 
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; 
      margin: 0;
      padding: 24px; 
      line-height: 1.45;
      background: linear-gradient(135deg, #fff5f8 0%, #f0f9ff 100%);
      min-height: 100vh;
    }
    @media (prefers-color-scheme: dark) {
      body { background: linear-gradient(135deg, #1a1625 0%, #1e2235 100%); }
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 { 
      margin: 0 0 12px; 
      background: linear-gradient(135deg, var(--baby-pink) 0%, var(--baby-blue) 50%, var(--baby-lavender) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: 2.2rem;
      font-weight: 700;
    }
    .grid { display: grid; grid-template-columns: repeat(auto-fill,minmax(260px,1fr)); gap: 16px; margin-top: 16px; }
    .card { 
      border: 3px solid;
      border-radius: 16px; 
      padding: 18px; 
      background: #fff;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .card:nth-child(6n+1) { border-color: var(--baby-pink); }
    .card:nth-child(6n+2) { border-color: var(--baby-blue); }
    .card:nth-child(6n+3) { border-color: var(--baby-yellow); }
    .card:nth-child(6n+4) { border-color: var(--baby-mint); }
    .card:nth-child(6n+5) { border-color: var(--baby-lavender); }
    .card:nth-child(6n+6) { border-color: var(--baby-peach); }
    .card:hover { 
      transform: translateY(-4px); 
      box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    }
    @media (prefers-color-scheme: dark) {
      .card { 
        background: #242838; 
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      }
      .card:hover { box-shadow: 0 8px 20px rgba(0,0,0,0.4); }
    }
    .card h3 { margin: 0 0 10px; font-size: 1.1rem; color: #2a2a2a; }
    @media (prefers-color-scheme: dark) {
      .card h3 { color: #f0f0f0; }
    }
    .card img { width: 100%; height: 200px; object-fit: cover; border-radius: 10px; margin-bottom: 12px; }
    .card p { margin: 0 0 12px; color: #555; }
    .card .prix { font-weight: 700; font-size: 1.1rem; }
    .card:nth-child(6n+1) .prix { color: #e91e8c; }
    .card:nth-child(6n+2) .prix { color: #4aa3d9; }
    .card:nth-child(6n+3) .prix { color: #f39c12; }
    .card:nth-child(6n+4) .prix { color: #27ae60; }
    .card:nth-child(6n+5) .prix { color: #9b59b6; }
    .card:nth-child(6n+6) .prix { color: #e74c3c; }
    @media (prefers-color-scheme: dark) {
      .card p { color: #ccc; }
      .card:nth-child(6n+1) .prix { color: var(--baby-pink); }
      .card:nth-child(6n+2) .prix { color: var(--baby-blue); }
      .card:nth-child(6n+3) .prix { color: var(--baby-yellow); }
      .card:nth-child(6n+4) .prix { color: var(--baby-mint); }
      .card:nth-child(6n+5) .prix { color: var(--baby-lavender); }
      .card:nth-child(6n+6) .prix { color: var(--baby-peach); }
    }
    .btn { 
      cursor: pointer; 
      border: 0; 
      padding: 12px 16px; 
      border-radius: 12px; 
      font-weight: 600;
      transition: all 0.2s;
    }
    .btn-primary { 
      background: linear-gradient(135deg, var(--baby-pink) 0%, var(--baby-blue) 100%);
      color: #fff;
    }
    .btn-primary:hover:not(:disabled) { 
      transform: scale(1.02);
      box-shadow: 0 4px 12px rgba(137, 207, 240, 0.4);
    }
    .btn:disabled { 
      opacity: 0.6; 
      cursor: not-allowed;
      position: relative;
    }
    .btn:disabled::after {
      content: '';
      position: absolute;
      width: 16px;
      height: 16px;
      margin-left: 10px;
      border: 2px solid #fff;
      border-top-color: transparent;
      border-radius: 50%;
      animation: spinner 0.8s linear infinite;
    }
    @keyframes spinner {
      to { transform: rotate(360deg); }
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
      backdrop-filter: blur(5px);
      animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .modal-content {
      background: #fff;
      border-radius: 20px;
      padding: 40px;
      max-width: 500px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      position: relative;
      animation: slideUp 0.3s ease;
      text-align: center;
    }
    @keyframes slideUp {
      from { transform: translateY(50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    @media (prefers-color-scheme: dark) {
      .modal-content { background: #242838; }
    }
    .modal-icon {
      font-size: 4rem;
      margin-bottom: 20px;
      animation: bounce 0.6s ease;
    }
    @keyframes bounce {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }
    .modal-content h2 {
      margin: 0 0 16px;
      font-size: 1.8rem;
      background: linear-gradient(135deg, var(--baby-pink) 0%, var(--baby-blue) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .modal-content p {
      margin: 12px 0;
      color: #555;
      line-height: 1.6;
    }
    @media (prefers-color-scheme: dark) {
      .modal-content p { color: #ccc; }
    }
    .modal-summary {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-left: 4px solid var(--baby-blue);
      padding: 20px;
      border-radius: 12px;
      margin: 24px 0;
      text-align: left;
    }
    @media (prefers-color-scheme: dark) {
      .modal-summary {
        background: linear-gradient(135deg, #1a1f2e 0%, #242938 100%);
      }
    }
    .modal-summary-item {
      display: flex;
      justify-content: space-between;
      margin: 10px 0;
      padding: 8px 0;
      border-bottom: 1px solid rgba(0,0,0,0.1);
    }
    .modal-summary-item:last-child {
      border-bottom: none;
    }
    @media (prefers-color-scheme: dark) {
      .modal-summary-item { border-bottom-color: rgba(255,255,255,0.1); }
    }
    .modal-summary-label {
      font-weight: 600;
      color: #2a2a2a;
    }
    .modal-summary-value {
      color: #666;
      font-weight: 500;
    }
    @media (prefers-color-scheme: dark) {
      .modal-summary-label { color: #e0e0e0; }
      .modal-summary-value { color: #aaa; }
    }
    .modal-btn {
      margin-top: 24px;
      padding: 14px 32px;
      font-size: 1rem;
      border-radius: 12px;
      border: none;
      background: linear-gradient(135deg, var(--baby-pink) 0%, var(--baby-blue) 100%);
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .modal-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(137, 207, 240, 0.4);
    }
    .btn-cancel {
      background: linear-gradient(135deg, #e0e0e0 0%, #f5f5f5 100%);
      color: #555;
    }
    .btn-cancel:hover {
      background: linear-gradient(135deg, #d0d0d0 0%, #e5e5e5 100%);
    }
    form { display: grid; gap: 10px; margin-top: 12px; }
    input, textarea { 
      padding: 12px; 
      border-radius: 10px; 
      border: 2px solid #ddd; 
      width: 100%;
      box-sizing: border-box;
      transition: border-color 0.2s;
      font-family: inherit;
      font-size: 0.95rem;
    }
    input:focus, textarea:focus {
      outline: none;
      border-color: var(--baby-blue);
      box-shadow: 0 0 0 3px rgba(137, 207, 240, 0.2);
    }
    .notice { 
      background: linear-gradient(135deg, #fff0f6 0%, #e6f7ff 100%);
      border: 2px solid var(--baby-pink);
      border-left: 6px solid var(--baby-blue);
      padding: 16px; 
      border-radius: 12px; 
      margin: 16px 0; 
      color: #2a2a2a;
      font-size: 0.95rem;
    }
    @media (prefers-color-scheme: dark) {
      .notice { 
        background: linear-gradient(135deg, #2a1f2e 0%, #1f2a3a 100%);
        border-color: var(--baby-lavender);
        border-left-color: var(--baby-blue);
        color: #e0e0e0; 
      }
    }
    .hidden { display: none; }
    .instructions {
      margin: 24px 0;
    }
    .instructions h2 {
      text-align: center;
      font-size: 1.5rem;
      margin-bottom: 20px;
      color: #2a2a2a;
    }
    @media (prefers-color-scheme: dark) {
      .instructions h2 { color: #f0f0f0; }
    }
    .option-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 16px;
    }
    .option-card {
      background: #fff;
      border: 3px solid;
      border-radius: 16px;
      padding: 24px;
      position: relative;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      transition: transform 0.2s;
    }
    .option-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    }
    .option-card:nth-child(1) {
      border-color: var(--baby-mint);
    }
    .option-card:nth-child(2) {
      border-color: var(--baby-peach);
    }
    @media (prefers-color-scheme: dark) {
      .option-card {
        background: #242838;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      }
      .option-card:hover {
        box-shadow: 0 8px 20px rgba(0,0,0,0.4);
      }
    }
    .option-number {
      position: absolute;
      top: -12px;
      right: 20px;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1.2rem;
      color: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    .option-card:nth-child(1) .option-number {
      background: var(--baby-mint);
    }
    .option-card:nth-child(2) .option-number {
      background: var(--baby-peach);
    }
    .option-card h3 {
      margin: 0 0 12px;
      font-size: 1.2rem;
      color: #2a2a2a;
    }
    @media (prefers-color-scheme: dark) {
      .option-card h3 { color: #f0f0f0; }
    }
    .option-card > p {
      color: #666;
      margin-bottom: 16px;
    }
    @media (prefers-color-scheme: dark) {
      .option-card > p { color: #aaa; }
    }
    .option-details {
      margin-top: 16px;
    }
    .option-details strong {
      color: #2a2a2a;
    }
    @media (prefers-color-scheme: dark) {
      .option-details strong { color: #e0e0e0; }
    }
    .info-box {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-left: 4px solid var(--baby-blue);
      padding: 16px;
      border-radius: 8px;
      margin: 12px 0;
    }
    @media (prefers-color-scheme: dark) {
      .info-box {
        background: linear-gradient(135deg, #1a1f2e 0%, #242938 100%);
      }
    }
    .info-box p {
      margin: 8px 0;
      font-size: 0.95rem;
      color: #2a2a2a;
    }
    @media (prefers-color-scheme: dark) {
      .info-box p { color: #e0e0e0; }
    }
    .info-box .editable {
      background: #fff3cd;
      padding: 2px 8px;
      border-radius: 4px;
      font-family: monospace;
      font-weight: 600;
    }
    @media (prefers-color-scheme: dark) {
      .info-box .editable {
        background: #4a4020;
        color: #ffd166;
      }
    }
    .note {
      font-size: 0.9rem;
      font-style: italic;
      color: #666;
      margin-top: 12px;
    }
    @media (prefers-color-scheme: dark) {
      .note { color: #999; }
    }
    .payment-choice {
      margin: 8px 0;
    }
    .choice-label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #2a2a2a;
      font-size: 0.95rem;
    }
    @media (prefers-color-scheme: dark) {
      .choice-label { color: #e0e0e0; }
    }
    .radio-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .radio-option {
      display: flex;
      align-items: center;
      padding: 10px 12px;
      border: 2px solid #ddd;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      background: #fff;
    }
    .radio-option:hover {
      border-color: var(--baby-blue);
      background: #f8f9fa;
    }
    .radio-option input[type="radio"] {
      width: auto;
      margin-right: 10px;
      cursor: pointer;
      accent-color: var(--baby-blue);
    }
    .radio-option input[type="radio"]:checked + span {
      font-weight: 600;
    }
    .radio-option:has(input[type="radio"]:checked) {
      border-color: var(--baby-blue);
      background: linear-gradient(135deg, #f0f9ff 0%, #e6f7ff 100%);
    }
    @media (prefers-color-scheme: dark) {
      .radio-option {
        background: #242838;
        border-color: #333;
      }
      .radio-option:hover {
        border-color: var(--baby-blue);
        background: #2a3040;
      }
      .radio-option:has(input[type="radio"]:checked) {
        background: linear-gradient(135deg, #1a2a3a 0%, #1e2e3e 100%);
      }
    }
    footer { 
      margin-top: 32px; 
      padding: 16px;
      background: linear-gradient(135deg, var(--baby-mint) 0%, var(--baby-yellow) 100%);
      border-radius: 12px;
      color: #2a2a2a;
      font-size: 0.9rem;
      text-align: center;
    }
    @media (prefers-color-scheme: dark) {
      footer { color: #1a1a1a; }
    }
    .lang-selector { display: flex; gap: 10px; margin: 12px 0; flex-wrap: wrap; }
    .lang-btn { 
      cursor: pointer; 
      border: 2px solid;
      padding: 10px 18px; 
      border-radius: 12px; 
      background: #fff; 
      font-size: 0.95rem; 
      font-weight: 600;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .flag-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 22px;
      border-radius: 4px;
      font-size: 0.7rem;
      font-weight: 700;
      letter-spacing: 0.5px;
      color: #fff;
    }
    .lang-btn:nth-child(1) { border-color: var(--baby-pink); }
    .lang-btn:nth-child(1) .flag-icon { background: #ed2939; box-shadow: inset 0 0 0 2px #002395; }
    .lang-btn:nth-child(2) { border-color: var(--baby-blue); }
    .lang-btn:nth-child(2) .flag-icon { background: #003580; }
    .lang-btn:nth-child(3) { border-color: var(--baby-lavender); }
    .lang-btn:nth-child(3) .flag-icon { background: #012169; }
    .lang-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .lang-btn:nth-child(1).active { background: var(--baby-pink); color: #fff; }
    .lang-btn:nth-child(2).active { background: var(--baby-blue); color: #fff; }
    .lang-btn:nth-child(3).active { background: var(--baby-lavender); color: #fff; }
    @media (prefers-color-scheme: dark) {
      .lang-btn { background: #242838; color: #fff; }
      .lang-btn:nth-child(1).active { background: var(--baby-pink); }
      .lang-btn:nth-child(2).active { background: var(--baby-blue); }
      .lang-btn:nth-child(3).active { background: var(--baby-lavender); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 data-i18n="title">Liste de naissance</h1>
    
    <div class="lang-selector">
      <button class="lang-btn" data-lang="fr"><span class="flag-icon">FR</span> Fran√ßais</button>
      <button class="lang-btn" data-lang="fi"><span class="flag-icon">FI</span> Suomi</button>
      <button class="lang-btn" data-lang="en"><span class="flag-icon">EN</span> English</button>
    </div>

    <p class="notice" data-i18n="notice">
      R√©servez un objet ci-dessous. Apr√®s r√©servation, l'objet <strong>n'appara√Æt plus</strong> pour les autres.
      On vous demande seulement votre <em>pr√©nom</em> et un <em>petit mot</em>.
    </p>

    <div class="instructions">
      <h2 data-i18n="instructions_title">üíù Comment proc√©der apr√®s votre r√©servation ?</h2>
      
      <div class="option-cards">
        <div class="option-card">
          <div class="option-number">1</div>
          <h3 data-i18n="option1_title">üè¶ Je commande pour vous</h3>
          <p data-i18n="option1_desc">Transf√©rez-moi l'argent et je m'occupe de tout !</p>
          <div class="option-details">
            <p><strong data-i18n="bank_info">Coordonn√©es bancaires :</strong></p>
            <div class="info-box">
              <p><strong>IBAN :</strong> <span class="editable">FR00 0000 0000 0000 0000 0000 000</span></p>
              <p><strong data-i18n="account_name">Titulaire :</strong> <span class="editable">Votre Nom</span></p>
            </div>
            <p class="note" data-i18n="option1_note">üí° Indiquez le nom de l'objet dans le libell√© du virement</p>
          </div>
        </div>

        <div class="option-card">
          <div class="option-number">2</div>
          <h3 data-i18n="option2_title">üì¶ Vous commandez directement</h3>
          <p data-i18n="option2_desc">Commandez sur le site et faites livrer ici :</p>
          <div class="option-details">
            <p><strong data-i18n="delivery_info">Adresse de livraison :</strong></p>
            <div class="info-box">
              <p><strong data-i18n="name">Nom :</strong> <span class="editable">Pr√©nom NOM</span></p>
              <p><strong data-i18n="address">Adresse :</strong> <span class="editable">123 Rue Exemple</span></p>
              <p><strong data-i18n="city">Ville :</strong> <span class="editable">75000 Paris</span></p>
              <p><strong data-i18n="phone">T√©l√©phone :</strong> <span class="editable">06 12 34 56 78</span></p>
            </div>
            <p class="note" data-i18n="option2_note">üí° Utilisez le lien fourni sur chaque objet</p>
          </div>
        </div>
      </div>
    </div>

    <div id="grid" class="grid"></div>

    <!-- Gabarit d'une carte d'objet -->
    <template id="tpl-card">
      <div class="card">
        <img class="item-image hidden" alt="" />
        <h3 class="title"></h3>
        <p class="prixp hidden"><span data-i18n="price">Prix</span> : <span class="prix"></span></p>
        <p class="linkp hidden"><span data-i18n="link">Lien</span> : <a class="link" target="_blank" rel="noopener" data-i18n="view">Voir</a></p>
        <button class="btn btn-primary btn-reserve" data-i18n="reserve">R√©server</button>

        <form class="reserve-form hidden">
          <input name="name" type="text" autocomplete="given-name" data-i18n-placeholder="name_placeholder" placeholder="Votre pr√©nom" required />
          <input name="email" type="email" autocomplete="email" data-i18n-placeholder="email_placeholder" placeholder="Votre email" required />
          
          <div class="payment-choice">
            <label class="choice-label" data-i18n="payment_method">Comment allez-vous proc√©der ?</label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="payment_option" value="virement" required />
                <span data-i18n="option_bank">üè¶ Vous me transf√©rez l'argent</span>
              </label>
              <label class="radio-option">
                <input type="radio" name="payment_option" value="direct" required />
                <span data-i18n="option_direct">üì¶ Je commande directement</span>
              </label>
            </div>
          </div>
          
          <textarea name="message" autocomplete="off" data-i18n-placeholder="message_placeholder" placeholder="Petit mot (optionnel)" rows="3"></textarea>
          <div style="display:flex; gap:8px; flex-wrap:wrap;">
            <button type="submit" class="btn btn-primary" data-i18n="confirm">Confirmer la r√©servation</button>
            <button type="button" class="btn btn-cancel" data-i18n="cancel">Annuler</button>
          </div>
          <input type="hidden" name="item_id" />
          <input type="hidden" name="item_label" />
          <input type="hidden" name="lang" class="user-lang" />
          <!-- champ anti-bot discret (honeypot) -->
          <input type="text" name="website" class="hidden" tabindex="-1" autocomplete="off" />
        </form>
      </div>
    </template>

    <footer>
      <p data-i18n="footer">Astuce : les liens donn√©s sont indicatifs ‚Äî vous pouvez acheter ailleurs si vous pr√©f√©rez.</p>
    </footer>
  </div>

  <script>
    // REMPLACE par l'URL de ton d√©ploiement Apps Script (qui finit par /exec)
    const APP_URL = 'https://script.google.com/macros/s/AKfycbyLfFU8BfF9iL0NmAd-xPXZiZKjTn0rI_gUBA0KgEVH0QZOY1VjQulM0ZzMRy8U2MSc/exec'; // ‚ö†Ô∏è √Ä REMPLACER par votre URL de d√©ploiement

    // ‚Äî‚Äî‚Äî D√©tection mobile pour drapeaux ‚Äî‚Äî‚Äî
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;
    
    if (isMobile) {
      // Sur mobile, remplacer les badges par des emojis de drapeaux
      document.addEventListener('DOMContentLoaded', () => {
        const flags = {
          'fr': 'üá´üá∑',
          'fi': 'üá´üáÆ',
          'en': 'üá¨üáß'
        };
        
        document.querySelectorAll('.lang-btn').forEach(btn => {
          const lang = btn.dataset.lang;
          const flagIcon = btn.querySelector('.flag-icon');
          if (flagIcon && flags[lang]) {
            flagIcon.textContent = flags[lang];
            flagIcon.style.width = 'auto';
            flagIcon.style.background = 'none';
            flagIcon.style.boxShadow = 'none';
            flagIcon.style.fontSize = '1.3rem';
          }
        });
      });
    }

    // ‚Äî‚Äî‚Äî Syst√®me de traduction ‚Äî‚Äî‚Äî
    const translations = {
      fr: {
        title: 'Liste de naissance',
        notice: 'R√©servez un objet ci-dessous. Apr√®s r√©servation, l\'objet <strong>n\'appara√Æt plus</strong> pour les autres. On vous demande seulement votre <em>pr√©nom</em> et un <em>petit mot</em>.',
        instructions_title: 'üíù Comment proc√©der apr√®s votre r√©servation ?',
        option1_title: 'üè¶ Je commande pour vous',
        option1_desc: 'Transf√©rez-moi l\'argent et je m\'occupe de tout !',
        bank_info: 'Coordonn√©es bancaires :',
        account_name: 'Titulaire :',
        option1_note: 'üí° Indiquez le nom de l\'objet dans le libell√© du virement',
        option2_title: 'üì¶ Vous commandez directement',
        option2_desc: 'Commandez sur le site et faites livrer ici :',
        delivery_info: 'Adresse de livraison :',
        name: 'Nom :',
        address: 'Adresse :',
        city: 'Ville :',
        phone: 'T√©l√©phone :',
        option2_note: 'üí° Utilisez le lien fourni sur chaque objet',
        price: 'Prix',
        link: 'Lien',
        view: 'Voir',
        reserve: 'R√©server',
        name_placeholder: 'Votre pr√©nom',
        email_placeholder: 'Votre email',
        payment_method: 'Comment allez-vous proc√©der ?',
        option_bank: 'üè¶ Vous me transf√©rez l\'argent',
        option_direct: 'üì¶ Je commande directement',
        message_placeholder: 'Petit mot (optionnel)',
        confirm: 'Confirmer la r√©servation',
        sending: 'Envoi en cours...',
        cancel: 'Annuler',
        modal_title: 'R√©servation confirm√©e !',
        modal_subtitle: 'Merci beaucoup pour votre cadeau',
        modal_item: 'Objet r√©serv√©',
        modal_name: 'Votre pr√©nom',
        modal_payment: 'Option choisie',
        modal_payment_bank: 'Virement bancaire',
        modal_payment_direct: 'Commande directe',
        modal_email_sent: 'Un email de confirmation avec toutes les instructions vous a √©t√© envoy√© √†',
        modal_close: 'Fermer',
        footer: 'Astuce : les liens donn√©s sont indicatifs ‚Äî vous pouvez acheter ailleurs si vous pr√©f√©rez.',
        all_reserved: 'Tous les objets ont √©t√© r√©serv√©s üéâ',
        no_items: '‚ö†Ô∏è Aucun objet trouv√© dans la feuille "List" du Google Sheet.',
        error_load: '‚ùå Erreur de chargement. V√©rifiez que l\'URL de d√©ploiement est correcte.',
        form_error: 'Erreur de formulaire.',
        thanks: 'Merci ! R√©servation confirm√©e.',
        error_occurred: 'D√©sol√©, une erreur est survenue. R√©essayez dans un instant.'
      },
      fi: {
        title: 'Vauvalahjalista',
        notice: 'Varaa esine alta. Varauksen j√§lkeen esine <strong>ei n√§y en√§√§</strong> muille. Kysymme vain <em>etunimesi</em> ja <em>pienen viestin</em>.',
        instructions_title: 'üíù Miten edet√§ varauksen j√§lkeen?',
        option1_title: 'üè¶ Tilaan puolestasi',
        option1_desc: 'L√§het√§ minulle rahat niin hoidan kaiken!',
        bank_info: 'Pankkitiedot:',
        account_name: 'Tilinomistaja:',
        option1_note: 'üí° Merkitse esineen nimi viestikentt√§√§n',
        option2_title: 'üì¶ Tilaat suoraan',
        option2_desc: 'Tilaa sivustolta ja toimita t√§nne:',
        delivery_info: 'Toimitusosoite:',
        name: 'Nimi:',
        address: 'Osoite:',
        city: 'Kaupunki:',
        phone: 'Puhelin:',
        option2_note: 'üí° K√§yt√§ jokaisessa esineess√§ annettua linkki√§',
        price: 'Hinta',
        link: 'Linkki',
        view: 'Katso',
        reserve: 'Varaa',
        name_placeholder: 'Etunimesi',
        email_placeholder: 'S√§hk√∂postisi',
        payment_method: 'Miten aiot edet√§?',
        option_bank: 'üè¶ L√§het√§t minulle rahat',
        option_direct: 'üì¶ Tilaan suoraan',
        message_placeholder: 'Pieni viesti (valinnainen)',
        confirm: 'Vahvista varaus',
        sending: 'L√§hetet√§√§n...',
        cancel: 'Peruuta',
        modal_title: 'Varaus vahvistettu!',
        modal_subtitle: 'Kiitos paljon lahjastasi',
        modal_item: 'Varattu esine',
        modal_name: 'Nimesi',
        modal_payment: 'Valittu vaihtoehto',
        modal_payment_bank: 'Tilisiirto',
        modal_payment_direct: 'Suora tilaus',
        modal_email_sent: 'Vahvistusviesti, jossa on kaikki ohjeet, on l√§hetetty osoitteeseen',
        modal_close: 'Sulje',
        footer: 'Vinkki: annetut linkit ovat ohjeellisia ‚Äî voit ostaa muualtakin jos haluat.',
        all_reserved: 'Kaikki esineet on varattu üéâ',
        no_items: '‚ö†Ô∏è Ei esineit√§ Google Sheetin "List"-v√§lilehdell√§.',
        error_load: '‚ùå Latausvirhe. Tarkista, ett√§ k√§ytt√∂√∂noton URL on oikea.',
        form_error: 'Lomakevirhe.',
        thanks: 'Kiitos! Varaus vahvistettu.',
        error_occurred: 'Anteeksi, tapahtui virhe. Yrit√§ hetken kuluttua uudelleen.'
      },
      en: {
        title: 'Baby Registry',
        notice: 'Reserve an item below. After reservation, the item <strong>will no longer appear</strong> for others. We only ask for your <em>first name</em> and a <em>short message</em>.',
        instructions_title: 'üíù How to proceed after your reservation?',
        option1_title: 'üè¶ I order for you',
        option1_desc: 'Transfer me the money and I\'ll take care of everything!',
        bank_info: 'Bank details:',
        account_name: 'Account holder:',
        option1_note: 'üí° Include the item name in the transfer reference',
        option2_title: 'üì¶ You order directly',
        option2_desc: 'Order from the website and ship here:',
        delivery_info: 'Delivery address:',
        name: 'Name:',
        address: 'Address:',
        city: 'City:',
        phone: 'Phone:',
        option2_note: 'üí° Use the link provided on each item',
        price: 'Price',
        link: 'Link',
        view: 'View',
        reserve: 'Reserve',
        name_placeholder: 'Your first name',
        email_placeholder: 'Your email',
        payment_method: 'How will you proceed?',
        option_bank: 'üè¶ You transfer me the money',
        option_direct: 'üì¶ I order directly',
        message_placeholder: 'Short message (optional)',
        confirm: 'Confirm reservation',
        sending: 'Sending...',
        cancel: 'Cancel',
        modal_title: 'Reservation confirmed!',
        modal_subtitle: 'Thank you so much for your gift',
        modal_item: 'Reserved item',
        modal_name: 'Your name',
        modal_payment: 'Chosen option',
        modal_payment_bank: 'Bank transfer',
        modal_payment_direct: 'Direct order',
        modal_email_sent: 'A confirmation email with all instructions has been sent to',
        modal_close: 'Close',
        footer: 'Tip: the links provided are indicative ‚Äî you can buy elsewhere if you prefer.',
        all_reserved: 'All items have been reserved üéâ',
        no_items: '‚ö†Ô∏è No items found in the "List" sheet of the Google Sheet.',
        error_load: '‚ùå Loading error. Check that the deployment URL is correct.',
        form_error: 'Form error.',
        thanks: 'Thank you! Reservation confirmed.',
        error_occurred: 'Sorry, an error occurred. Please try again in a moment.'
      }
    };

    let currentLang = localStorage.getItem('lang') || detectLanguage();

    function detectLanguage() {
      const browserLang = navigator.language.toLowerCase();
      if (browserLang.startsWith('fi')) return 'fi';
      if (browserLang.startsWith('en')) return 'en';
      return 'fr'; // d√©faut
    }

    function setLanguage(lang) {
      currentLang = lang;
      localStorage.setItem('lang', lang);
      
      // Mettre √† jour l'attribut lang du HTML
      document.documentElement.lang = lang;
      
      // Mettre √† jour le titre de la page
      document.getElementById('page-title').textContent = translations[lang].title;
      
      // Mettre √† jour les boutons
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === lang);
      });
      
      // Mettre √† jour tous les textes
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.dataset.i18n;
        if (translations[lang][key]) {
          el.innerHTML = translations[lang][key];
        }
      });
      
      // Mettre √† jour les placeholders
      document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.dataset.i18nPlaceholder;
        if (translations[lang][key]) {
          el.placeholder = translations[lang][key];
        }
      });
    }

    // Fonction pour traduire un √©l√©ment sp√©cifique (utile pour les templates clon√©s)
    function translateElement(element) {
      element.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.dataset.i18n;
        if (translations[currentLang][key]) {
          el.innerHTML = translations[currentLang][key];
        }
      });
      
      element.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.dataset.i18nPlaceholder;
        if (translations[currentLang][key]) {
          el.placeholder = translations[currentLang][key];
        }
      });
    }

    // Initialiser la langue au chargement
    document.addEventListener('DOMContentLoaded', () => {
      setLanguage(currentLang);
      
      // Ajouter les √©couteurs sur les boutons de langue
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          setLanguage(btn.dataset.lang);
          // Recharger les donn√©es avec la nouvelle langue
          loadAndRenderItems();
        });
      });
    });

    // ‚Äî‚Äî‚Äî Modal de confirmation ‚Äî‚Äî‚Äî
    function showConfirmationModal(itemLabel, userName, userEmail, paymentOption) {
      const paymentText = paymentOption === 'virement' 
        ? translations[currentLang].modal_payment_bank
        : translations[currentLang].modal_payment_direct;
      
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="modal-icon">üéâ</div>
          <h2>${translations[currentLang].modal_title}</h2>
          <p>${translations[currentLang].modal_subtitle} üíù</p>
          
          <div class="modal-summary">
            <div class="modal-summary-item">
              <span class="modal-summary-label">${translations[currentLang].modal_item}:</span>
              <span class="modal-summary-value">${itemLabel}</span>
            </div>
            <div class="modal-summary-item">
              <span class="modal-summary-label">${translations[currentLang].modal_name}:</span>
              <span class="modal-summary-value">${userName}</span>
            </div>
            <div class="modal-summary-item">
              <span class="modal-summary-label">${translations[currentLang].modal_payment}:</span>
              <span class="modal-summary-value">${paymentText}</span>
            </div>
          </div>
          
          <p style="font-size: 0.9rem;">
            üìß ${translations[currentLang].modal_email_sent} <strong>${userEmail}</strong>
          </p>
          
          <button class="modal-btn" onclick="this.closest('.modal-overlay').remove()">
            ${translations[currentLang].modal_close}
          </button>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      // Fermer en cliquant sur l'overlay
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.remove();
        }
      });
    }

    // ‚Äî‚Äî‚Äî Fonctions utilitaires ‚Äî‚Äî‚Äî
    async function fetchData() {
      // GET simple (pas de headers personnalis√©s) ‚Üí √©vite les soucis CORS
      const r = await fetch(APP_URL, { method: 'GET' });
      if (!r.ok) throw new Error('GET data failed');
      const json = await r.json();
      return {
        items: json.items || [],
        reservedIds: new Set(json.reserved_ids || [])
      };
    }

    function renderItems(items, reservedSet) {
      const grid = document.getElementById('grid');
      const tpl = document.getElementById('tpl-card');
      grid.innerHTML = '';

      const visible = items.filter(it => !reservedSet.has(it.id));
      visible.forEach(item => {
        const node = tpl.content.cloneNode(true);
        const card = node.querySelector('.card');
        const image = node.querySelector('.item-image');
        const title = node.querySelector('.title');
        const prixp = node.querySelector('.prixp');
        const prix = node.querySelector('.prix');
        const linkp = node.querySelector('.linkp');
        const link = node.querySelector('.link');
        const btn = node.querySelector('.btn-reserve');
        const form = node.querySelector('.reserve-form');
        const cancel = node.querySelector('.btn-cancel');

        // Traduire les √©l√©ments du template clon√©
        translateElement(card);

        // Afficher l'image si elle existe
        if (item.image) {
          image.src = item.image;
          image.alt = item.label;
          image.classList.remove('hidden');
        }

        title.textContent = item.label;
        
        if (item.prix) {
          // Ajoute le symbole ‚Ç¨ si absent
          const prixText = item.prix.toString();
          prix.textContent = prixText.includes('‚Ç¨') ? prixText : prixText + ' ‚Ç¨';
          prixp.classList.remove('hidden');
        }
        
        if (item.url) {
          link.href = item.url;
          linkp.classList.remove('hidden');
        }

        form.item_id.value = item.id;
        form.item_label.value = item.label;
        form.querySelector('.user-lang').value = currentLang;

        btn.addEventListener('click', () => {
          btn.classList.add('hidden');
          form.classList.remove('hidden');
        });

        cancel.addEventListener('click', () => {
          form.reset();
          form.classList.add('hidden');
          btn.classList.remove('hidden');
        });

        form.addEventListener('submit', async (ev) => {
          ev.preventDefault();

          // Honeypot anti-bot (si rempli ‚Üí on ignore)
          if (form.website && form.website.value) {
            alert(translations[currentLang].form_error);
            return;
          }

          // R√©cup√©rer le bouton de soumission
          const submitBtn = form.querySelector('button[type="submit"]');
          const originalText = submitBtn.textContent;
          
          // D√©sactiver le bouton et afficher le loading
          submitBtn.disabled = true;
          submitBtn.textContent = translations[currentLang].sending;

          const data = Object.fromEntries(new FormData(form).entries());

          // IMPORTANT : on envoie en x-www-form-urlencoded
          const formData = new URLSearchParams();
          formData.append('item_id', data.item_id);
          formData.append('item_label', data.item_label);
          formData.append('name', data.name);
          formData.append('email', data.email);
          formData.append('payment_option', data.payment_option);
          formData.append('message', data.message || '');
          formData.append('lang', data.lang || 'fr');

          // On √©vite tout header custom ‚Üí pas de pr√©-vol CORS
          try {
            const r = await fetch(APP_URL, { method: 'POST', body: formData });
            const json = await r.json();
            if (!json.ok) throw new Error(json.error || 'Erreur');
            card.remove(); // masque l'objet tout de suite
            showConfirmationModal(data.item_label, data.name, data.email, data.payment_option);
          } catch (e) {
            console.error(e);
            alert(translations[currentLang].error_occurred);
            
            // R√©activer le bouton en cas d'erreur
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
          }
        });

        grid.appendChild(node);
      });

      if (visible.length === 0) {
        document.getElementById('grid').innerHTML = `<p>${translations[currentLang].all_reserved}</p>`;
      }
    }

    async function loadAndRenderItems() {
      try {
        const { items, reservedIds } = await fetchData();
        if (items.length === 0) {
          document.getElementById('grid').innerHTML = `<p>${translations[currentLang].no_items}</p>`;
          return;
        }
        renderItems(items, reservedIds);
      } catch (e) {
        console.error('Impossible de charger les donn√©es', e);
        document.getElementById('grid').innerHTML = `<p>${translations[currentLang].error_load}</p>`;
      }
    }

    // ‚Äî‚Äî‚Äî Initialisation ‚Äî‚Äî‚Äî
    (async () => {
      await loadAndRenderItems();
    })();
  </script>
</body>
</html>
